<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Student ID Generator</title>
  <link rel="stylesheet" href="style.css" />
  <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/qrcodejs/1.0.0/qrcode.min.js"></script>
</head>
<body>
  <div id="main-container">
    <h1>ðŸŽ“ Student ID Card Generator</h1>
    <input type="file" id="fileInput" accept=".xlsx, .xls" />
    <div id="card-container"></div>
  </div>

  <script>
    document.getElementById("fileInput").addEventListener("change", handleFile);

    async function handleFile(e) {
      const file = e.target.files[0];
      if (!file) return;
      const data = await file.arrayBuffer();
      const workbook = XLSX.read(data);
      const sheetName = workbook.SheetNames[0];
      const sheet = workbook.Sheets[sheetName];
      const students = XLSX.utils.sheet_to_json(sheet);
      displayStudents(students);
    }

    function displayStudents(students) {
      const container = document.getElementById("card-container");
      container.innerHTML = "";

      students.forEach((s, i) => {
        const card = document.createElement("div");
        card.className = "student-card";
        card.innerHTML = `
          <img src="${s["photo"] || ""}" alt="photo">
          <div class="student-info">
            <h3>${s["name"] || ""}</h3>
            <p>${s["roll number"] || ""}</p>
            <button onclick='viewFull(${JSON.stringify(s)})'>View Full ID</button>
          </div>
        `;
        container.appendChild(card);
      });
    }

    function viewFull(s) {
      const container = document.getElementById("main-container");
      container.innerHTML = `
        <div id="idCard" class="id-card" style="
          background-image: url('${s["logo"] || ""}');
          background-size: cover;
          background-position: center;
          background-repeat: no-repeat;
        ">
          <div class="card-content">
            <div class="college-header">
              <div class="college-name">${s["college name"] || ""}</div>
              ${s["logo"] ? `<img src="${s["logo"]}" alt="logo" crossorigin="anonymous">` : ""}
            </div>

            <div class="id-title">ðŸŽ“ Student ID Card</div>

            <div class="photo-box">
              ${s["photo"] ? `<img src="${s["photo"]}" alt="photo" crossorigin="anonymous">` : ""}
            </div>

            <div class="info">
              <div><b>Name:</b> ${s["name"] || ""}</div>
              <div><b>Father's Name:</b> ${s["father name"] || ""}</div>
              <div><b>Roll No:</b> ${s["roll number"] || ""}</div>
              <div><b>Registration No:</b> ${s["registration number"] || ""}</div>
              <div><b>Course:</b> ${s["course"] || ""}</div>
              <div><b>Branch:</b> ${s["branch"] || ""}</div>
              <div><b>Session:</b> ${s["session"] || ""}</div>
              <div><b>Blood Group:</b> ${s["blood group"] || ""}</div>
              <div><b>Mobile No:</b> ${s["mobile number"] || ""}</div>
              <div><b>Address:</b> ${s["address"] || ""}</div>
            </div>

            <div class="institute-info">
              <div><b>Institute Code:</b> ${s["institute code"] || ""}</div>
              <div><b>Affiliated To:</b> ${s["affiliated to"] || ""}</div>
            </div>

            <div class="qr-box"><canvas id="qrCanvas"></canvas></div>

            <div class="btn-box">
              <button id="downloadBtn">Download ID</button>
              <button id="printBtn">Print</button>
              <button id="backBtn">Back</button>
            </div>
          </div>
        </div>
      `;

      // Generate QR
      const qrCanvas = document.getElementById("qrCanvas");
      new QRCode(qrCanvas, {
        text: JSON.stringify(s),
        width: 100,
        height: 100,
      });

      // Buttons
      document.getElementById("downloadBtn").addEventListener("click", downloadCard);
      document.getElementById("printBtn").addEventListener("click", () => window.print());
      document.getElementById("backBtn").addEventListener("click", () => location.reload());
    }

    async function downloadCard() {
      const card = document.getElementById("idCard");
      const canvas = await html2canvas(card, { useCORS: true, scale: 3 });
      const imgData = canvas.toDataURL("image/png");
      const pdf = new jspdf.jsPDF("p", "mm", "a4");
      const width = pdf.internal.pageSize.getWidth();
      const height = (canvas.height * width) / canvas.width;
      pdf.addImage(imgData, "PNG", 0, 0, width, height);
      pdf.save("Student_ID.pdf");
    }
  </script>

  <script src="https://cdn.sheetjs.com/xlsx-latest/package/dist/xlsx.full.min.js"></script>
</body>
</html>
